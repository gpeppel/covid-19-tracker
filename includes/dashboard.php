<div id="content">
    <div id="left-view">
        <form id="form" method="post" action="">
            <div class="form-input">
                <fieldset>
                    <legend>States</legend>
                    <table id="dynamic-tbl">
                        <tr>
                            <td><input type='checkbox' name='States[]' id='Alabama' value='Alabama'><label for='Alabama'>Alabama</label></td>
                            <td><input type='checkbox' name='States[]' id='Alaska' value='Alaska'><label for='Alaska'>Alaska</label></td>
                            <td><input type='checkbox' name='States[]' id='Arizona' value='Arizona'><label for='Arizona'>Arizona</label></td>
                            <td><input type='checkbox' name='States[]' id='Arkansas' value='Arkansas'><label for='Arkansas'>Arkansas</label></td>
                            <td><input type='checkbox' name='States[]' id='California' value='California'><label for='California'>California</label></td>
                        </tr>
                        <tr>
                            <td><input type='checkbox' name='States[]' id='Colorado' value='Colorado'><label for='Colorado'>Colorado</label></td>
                            <td><input type='checkbox' name='States[]' id='Connecticut' value='Connecticut'><label for='Connecticut'>Connecticut</label></td>
                            <td><input type='checkbox' name='States[]' id='Delaware' value='Delaware'><label for='Delaware'>Delaware</label></td>
                            <td><input type='checkbox' name='States[]' id='Florida' value='Florida'><label for='Florida'>Florida</label></td>
                            <td><input type='checkbox' name='States[]' id='Georgia' value='Georgia'><label for='Georgia'>Georgia</label></td>
                        </tr>
                        <tr>
                            <td><input type='checkbox' name='States[]' id='Hawaii' value='Hawaii'><label for='Hawaii'>Hawaii</label></td>
                            <td><input type='checkbox' name='States[]' id='Idaho' value='Idaho'><label for='Idaho'>Idaho</label></td>
                            <td><input type='checkbox' name='States[]' id='Illinois' value='Illinois'><label for='Illinois'>Illinois</label></td>
                            <td><input type='checkbox' name='States[]' id='Indiana' value='Indiana'><label for='Indiana'>Indiana</label></td>
                            <td><input type='checkbox' name='States[]' id='Iowa' value='Iowa'><label for='Iowa'>Iowa</label></td>
                        </tr>
                        <tr>
                            <td><input type='checkbox' name='States[]' id='Kansas' value='Kansas'><label for='Kansas'>Kansas</label></td>
                            <td><input type='checkbox' name='States[]' id='Kentucky' value='Kentucky'><label for='Kentucky'>Kentucky</label></td>
                            <td><input type='checkbox' name='States[]' id='Louisiana' value='Louisiana'><label for='Louisiana'>Louisiana</label></td>
                            <td><input type='checkbox' name='States[]' id='Maine' value='Maine'><label for='Maine'>Maine</label></td>
                            <td><input type='checkbox' name='States[]' id='Maryland' value='Maryland'><label for='Maryland'>Maryland</label></td>
                        </tr>
                        <tr>
                            <td><input type='checkbox' name='States[]' id='Massachusetts' value='Massachusetts'><label for='Massachusetts'>Massachusetts</label></td>
                            <td><input type='checkbox' name='States[]' id='Michigan' value='Michigan'><label for='Michigan'>Michigan</label></td>
                            <td><input type='checkbox' name='States[]' id='Minnesota' value='Minnesota'><label for='Minnesota'>Minnesota</label></td>
                            <td><input type='checkbox' name='States[]' id='Mississippi' value='Mississippi'><label for='Mississippi'>Mississippi</label></td>
                            <td><input type='checkbox' name='States[]' id='Missouri' value='Missouri'><label for='Missouri'>Missouri</label></td>
                        </tr>
                        <tr>
                            <td><input type='checkbox' name='States[]' id='Montana' value='Montana'><label for='Montana'>Montana</label></td>
                            <td><input type='checkbox' name='States[]' id='Nebraska' value='Nebraska'><label for='Nebraska'>Nebraska</label></td>
                            <td><input type='checkbox' name='States[]' id='Nevada' value='Nevada'><label for='Nevada'>Nevada</label></td>
                            <td><input type='checkbox' name='States[]' id='New Hampshire' value='New Hampshire'><label for='New Hampshire'>New Hampshire</label></td>
                            <td><input type='checkbox' name='States[]' id='New Jersey' value='New Jersey'><label for='New Jersey'>New Jersey</label></td>
                        </tr>
                        <tr>
                            <td><input type='checkbox' name='States[]' id='New Mexico' value='New Mexico'><label for='New Mexico'>New Mexico</label></td>
                            <td><input type='checkbox' name='States[]' id='New York' value='New York'><label for='New York'>New York</label></td>
                            <td><input type='checkbox' name='States[]' id='North Carolina' value='North Carolina'><label for='North Carolina'>North Carolina</label></td>
                            <td><input type='checkbox' name='States[]' id='North Dakota' value='North Dakota'><label for='North Dakota'>North Dakota</label></td>
                            <td><input type='checkbox' name='States[]' id='Ohio' value='Ohio'><label for='Ohio'>Ohio</label></td>
                        </tr>
                        <td><input type='checkbox' name='States[]' id='Oklahoma' value='Oklahoma'><label for='Oklahoma'>Oklahoma</label></td>
                        <td><input type='checkbox' name='States[]' id='Oregon' value='Oregon'><label for='Oregon'>Oregon</label></td>
                        <td><input type='checkbox' name='States[]' id='Pennsylvania' value='Pennsylvania'><label for='Pennsylvania'>Pennsylvania</label></td>
                        <td><input type='checkbox' name='States[]' id='Rhode Island' value='Rhode Island'><label for='Rhode Island'>Rhode Island</label></td>
                        <td><input type='checkbox' name='States[]' id='South Carolina' value='South Carolina'><label for='South Carolina'>South Carolina</label></td>
                        <tr>
                            <td><input type='checkbox' name='States[]' id='South Dakota' value='South Dakota'><label for='South Dakota'>South Dakota</label></td>
                            <td><input type='checkbox' name='States[]' id='Tennessee' value='Tennessee'><label for='Tennessee'>Tennessee</label></td>
                            <td><input type='checkbox' name='States[]' id='Texas' value='Texas'><label for='Texas'>Texas</label></td>
                            <td><input type='checkbox' name='States[]' id='Utah' value='Utah'><label for='Utah'>Utah</label></td>
                            <td><input type='checkbox' name='States[]' id='Vermont' value='Vermont'><label for='Vermont'>Vermont</label></td>
                        </tr>
                        <tr>
                            <td><input type='checkbox' name='States[]' id='Virginia' value='Virginia'><label for='Virginia'>Virginia</label></td>
                            <td><input type='checkbox' name='States[]' id='Washington' value='Washington'><label for='Washington'>Washington</label></td>
                            <td><input type='checkbox' name='States[]' id='West Virginia' value='West Virginia'><label for='West Virginia'>West Virginia</label></td>
                            <td><input type='checkbox' name='States[]' id='Wisconsin' value='Wisconsin'><label for='Wisconsin'>Wisconsin</label></td>
                            <td><input type='checkbox' name='States[]' id='Wyoming' value='Wyoming'><label for='Wyoming'>Wyoming</label></td>
                        </tr>
                    </table>
                </fieldset>

            </div>
            <div class="form-input">
                <script type="text/javascript">
                    function submitForm(action) {
                        var form = document.getElementById('form');
                        form.action = action;
                        form.submit();
                    }
                </script>
                <td><input type="submit" name='display' class="noborder" id="display" value="Submit" tabindex="4" /></td>
                <td><input type="submit" name='publish' class="noborder" id="PublishHomepage" onclick="submitForm('homepage.php')" value="Publish Homepage" tabindex="5" /></td>
                <td><input type="hidden" name="ip" value="<?php echo $_SERVER['REMOTE_ADDR']; ?>" /></td>

            </div>
        </form>
    </div>
    <div id="right-view">
        <div class="wrap-table100">
            <div class="table">
                <div class="btn-group">
                    <button class="button" style="vertical-align:middle"><span>State Name</span></button>
                    <button class="button" style="vertical-align:middle"><span>Cases</span></button>
                    <button class="button" style="vertical-align:middle"><span>New Cases</span></button>
                    <button class="button" style="vertical-align:middle"><span>Deaths</span></button>
                    <button class="button" style="vertical-align:middle"><span>New Deaths</span></button>

                </div>
                <?php
                $cnx = DB_connect();
                $caseDeltas = get_new_case_deltas();
                $deathDeltas = get_new_death_deltas();
                if (isset($_POST['display'])) {
                    if (!empty($_POST['States'])) {
                        $names = join("','", $_POST['States']);
                        $query = "SELECT * FROM States WHERE StateName IN ('$names')";
                        $cursor = $cnx->query($query);
                        $cnx->close();
                        while ($row = $cursor->fetch_array()) {
                            $n = $row[1];
                            $d = array_keys($caseDeltas);
                            if (in_array($n, $d)) {
                                $newCases = $caseDeltas[$n];
                                $newDeaths = $deathDeltas[$n];
                            }
                            echo '<div class="row">';
                            echo '<div class="cell" data-title="State Name">' . $row['StateName'] . '</div>';
                            echo '<div class="cell" data-title="Confirmed Cases">' . $row['ConfirmedCases'] . '</div>';
                            echo '<div class="cell" data-title="New Cases">' . $newCases . '</div>';
                            echo '<div class="cell" data-title="Confirmed Deaths">' . $row['ConfirmedDeaths'] . '</div>';
                            echo '<div class="cell" data-title="New Deaths">' . $newDeaths . '</div>';
                            echo '</div>';
                        }
                    }
                }
                ?>
                 <?php
                $cnx = DB_connect();
                $caseDeltas = get_new_case_deltas();
                $deathDeltas = get_new_death_deltas();
                if (isset($_POST['publish'])) {
                    if (!empty($_POST['States'])) {
                        $ip = get_user_ip();
                        $query = "INSERT INTO User (IPAddress) VALUES ('$ip')";
                        $cursor = $cnx->query($query);
                        $cnx->close();
                        $cnx = DB_connect();
                        $names = join("','", $_POST['States']);
                        $query = "SELECT * FROM States WHERE StateName IN ('$names')";
                        $cursor = $cnx->query($query);
                        $cnx->close();
                        while ($row = $cursor->fetch_array()) {
                            $n = $row[1];
                            $d = array_keys($caseDeltas);
                            if (in_array($n, $d)) {
                                $newCases = $caseDeltas[$n];
                                $newDeaths = $deathDeltas[$n];
                            }
                            echo '<div class="row">';
                            echo '<div class="cell" data-title="State Name">' . $row['StateName'] . '</div>';
                            echo '<div class="cell" data-title="Confirmed Cases">' . $row['ConfirmedCases'] . '</div>';
                            echo '<div class="cell" data-title="New Cases">' . $newCases . '</div>';
                            echo '<div class="cell" data-title="Confirmed Deaths">' . $row['ConfirmedDeaths'] . '</div>';
                            echo '<div class="cell" data-title="New Deaths">' . $newDeaths . '</div>';
                            echo '</div>';
                        }
                    }
                }
                ?>
            </div>
        </div>
    </div>
</div>
<div class="clear"></div>